(()=>{"use strict";let t;function e(e){t=e}const o="/api/get_todos",n={"Content-Type":"application/json; charset=utf-8"};async function i(){const e=await caches.open("todo-sw"),i=JSON.stringify(t);await e.put(o,new Response(i,{headers:new Headers({...n,"Cache-Control":"max-age=31536000","Content-Length":String(i.length)})}))}function r(t){const e=new Date;return e.setDate(e.getDate()+t),e.toISOString()}const s={icons:[{icon_id:1,icon_name:"page.png"},{icon_id:2,icon_name:"home.png"},{icon_id:3,icon_name:"other.png"},{icon_id:4,icon_name:"warning.png"},{icon_id:5,icon_name:"alert.png"},{icon_id:6,icon_name:"ball.png"},{icon_id:7,icon_name:"bug.png"},{icon_id:8,icon_name:"cart.png"},{icon_id:9,icon_name:"favorite.png"},{icon_id:10,icon_name:"inbox.png"},{icon_id:11,icon_name:"life.png"},{icon_id:12,icon_name:"mail.png"},{icon_id:13,icon_name:"twitter.png"},{icon_id:14,icon_name:"note.png"}],statuses:[{status_id:1,status:"низкий",color:"#808080"},{status_id:2,status:"нормальный",color:"#000000"},{status_id:3,status:"повышенный",color:"#008000"},{status_id:4,status:"высокий",color:"#E56353"}],categories:[{category_id:1,icon_id:3,category:"Работа"},{category_id:2,icon_id:2,category:"Дом"},{category_id:3,icon_id:6,category:"Здоровье"},{category_id:4,icon_id:7,category:"Фигня"}],todos:[{todo_id:1,status_id:1,category_id:1,todo:"Todo1",deleted:!1},{todo_id:2,status_id:2,category_id:2,todo:"Hover your mouse over a project or item and click the icon on the right side of the item for more",due_date:r(-1)},{todo_id:3,status_id:3,category_id:3,todo:"Todo3",due_date:function(t){const e=new Date;return e.setMinutes(e.getMinutes()+1),e.toISOString()}()},{todo_id:4,status_id:4,category_id:1,todo:"Todo4",due_date:r(1),completed:!0,deleted:!1},{todo_id:5,status_id:4,todo:"Todo5"},{todo_id:6,status_id:4,todo:"Todo6",completed:!0,deleted:!1},{todo_id:7,status_id:2,todo:"Todo7",completed:!0,deleted:!0}]},{log:a}=console;async function c(){if(void 0===t)try{const n=await caches.open("todo-sw"),r=await n.match(o);if(void 0!==r){const t=await r.json();t&&e(t)}t||(e(s),await i())}catch(t){a("sw: error in loadState",t)}}function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new Response(JSON.stringify({error:{code:500,error:t,data:e}}),{headers:n,status:200})}function u(t,e){t.respondWith(c().then((()=>e())).then((t=>(i(),t))))}function _(){return new Response(null,{status:404})}function l(t){return"number"==typeof t&&Number.isInteger(t)}function g(t){return null!=t}function f(t,e,o){return t>=e&&t<=o}function y(t){return"string"==typeof t}function p(t){return"boolean"==typeof t}function h(t){return null==t}function w(t,e){const o=Object.keys(e);for(let n=0;n<o.length;n++){const i=e[o[n]],[r,s]=i;if(!1===r(t))return{error:s}}return{entity:t}}const m=(!1,t=>{if(p(t))return t;if(y(t))switch(t.toLowerCase()){case"true":return!0;case"false":return!1;default:return}return!h(t)&&void 0});const v={todo_id:[t=>g(t.todo_id)&&l(t.todo_id),"обязательное поле todo_id должно быть целым числом"],status_id:[t=>g(t.status_id)&&l(t.status_id),"обязательное поле status_id должно быть целым числом"],category_id:[t=>h(t.category_id)||l(t.category_id),"необязательное поле category_id должно быть целым числом"],todo:[function(t){return!!y(t.todo)&&f(t.todo.length,5,100)},"длина названия todo должна быть более 5 символов и не превышать 100 символов"],description:[function(t){return!!h(t.description)||!!y(t.description)&&f(t.description.length,10,1e3)},"длина description должна быть более 10 символов и не превышать 1000 символов"],due_date:[t=>function(t){return!g(t)}(t.due_date)||y(t.due_date),"необязательное поле due_date должно быть строкой ISO 8086"],completed:[t=>p(t.completed),"поле completed должно быть boolean"],deleted:[t=>h(t.deleted)||p(t.deleted),"поле deleted должно быть boolean"]};function S(t,e){var o;const n=function(t){return w(function(t){const{todo_id:e,todo:o,status_id:n,category_id:i,description:r,due_date:s,deleted:a,completed:c}=t;return o&&n?{todo_id:e,todo:(d=o,"string"==typeof d?d[0].toUpperCase()+d.slice(1):void 0),status_id:n,category_id:i,description:r,due_date:s,deleted:m(a),completed:m(c)}:{};var d}(t),v)}(t);if(!n.entity)return n;const{entity:i}=n;return!1===e.statuses.some((t=>t.status_id===i.status_id))?{error:"Статус задачи не обнаружен в стправочнике!!"}:i.category_id&&!e.categories||!1===(null===(o=e.categories)||void 0===o?void 0:o.some((t=>i.category_id===t.category_id)))?{error:"Категория задачи не обнаружена в стправочнике!!"}:{entity:i}}function b(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return new Response(JSON.stringify({result:t}),{headers:n,status:e})}const O={category_id:[t=>g(t.category_id)&&l(t.category_id),"Category обязан иметь category_id целым числомr"],category:[function(t){return!!y(t.category)&&f(t.category.length,3,20)},"Длина названия категории должна быть более 3 символов и не превышать 20 символов"],icon_id:[t=>g(t.icon_id)&&l(t.icon_id),"Category обязан иметь icon_id целым числом"]};async function R(e,o){switch(o){case"create_category":return async function(e){try{const i=await e.json(),{entity:r,error:s}=function(t,e){var o;const n=function(t){return w(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{category_id:e,category:o,icon_id:n}=t;return o&&n?{category_id:e,category:o,icon_id:n}:{}}(t),O)}(t);if(!n.entity)return n;const{entity:i}=n;return null!==(o=e.categories)&&void 0!==o&&o.find((t=>t.category===i.category))?{error:"Нарушение уникальности имени категории"}:{entity:i}}(i,t);if(void 0!==s)return d(s);{var o,n;const e=(null==t||null===(o=t.categories)||void 0===o?void 0:o.map((t=>t.category_id)))||[1],i=Math.max(...e),s={...r,category_id:i};return null==t||null===(n=t.categories)||void 0===n||n.push(s),b(s)}}catch(t){const{message:e,stack:o}=t;return d(e,o)}}(e);case"create_todo":return async function(e){try{const i=await e.json(),{entity:r,error:s}=S(i,t);if(void 0!==s)return d(s);{var o,n;const e=(null==t||null===(o=t.todos)||void 0===o?void 0:o.map((t=>t.todo_id)))||[1],i=Math.max(...e),s={...r,todo_id:i};return null==t||null===(n=t.todos)||void 0===n||n.push(s),b(s)}}catch(t){const{message:e,stack:o}=t;return d(e,o)}}(e);case"log":{const t=await e.json(),{log:o}=console;switch(t.type){case"info":o("%c[INFO]","color: blue; font-weight: 600;",t);break;case"warn":o("%c[WARN]","color: #ff9905; font-weight: 600;",t);break;case"error":o(t),o("%c[ERROR]","color: #E56353;; font-weight: 600;",t)}return new Response(null,{status:200})}default:return _()}}self.VERSION="1.0.0";const{log:N}=console;self.onerror=function(t){N("sw error:",t)},self.addEventListener("fetch",(async function(e){const o=e.request.clone();var i=new URL(e.request.url);const r=i.pathname.slice(5);switch(e.request.method){case"POST":u(e,(()=>R(o,r)));break;case"PATCH":u(e,(()=>async function(t,e){switch(e){case"update_category":{const e=await t.json();return new Response(JSON.stringify(e),{status:200})}case"update_todo":{const e=await t.json();return new Response(JSON.stringify(e),{status:200})}default:return _()}}(o,r)));break;case"DELETE":u(e,(()=>async function(t,e){switch(e){case"delete_category":{const e=await t.json();return new Response(JSON.stringify(e),{status:200})}case"delete_todo":{const e=await t.json();return new Response(JSON.stringify(e),{status:200})}default:return _()}}(o,r)));break;case"GET":!async function(e,o){"/api/get_todos"===o&&e.respondWith(c().then((()=>new Response(JSON.stringify(t),{headers:n}))))}(e,i.pathname);break;default:e.respondWith(d("Не допустимый http метод"))}})),self.addEventListener("install",(t=>{self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil((async()=>{t||await c()})()),clients.claim()}))})();